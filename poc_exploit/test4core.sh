#!/bin/bash


COUNTER=0
echo "### 4 cores and 1 attacker thread" >> out1126.txt
	
for i in {1..2000}; do
	rm firefox_out2.txt
	pkill -9 firefox
	sleep 1
	firefox -CreateProfile "al$i /home/linglong/Documents/profiles/al$i"
	touch /home/linglong/Documents/profiles/al$i/user.js
	touch /home/linglong/Documents/profiles/al$i/prefs.js

	echo 'user_pref("browser.dom.window.dump.enabled", true);' >> /home/linglong/Documents/profiles/al$i/user.js
	echo 'user_pref("privacy.reduceTimerPrecision", false);' >> /home/linglong/Documents/profiles/al$i/user.j

	echo "Trial $COUNTER" >> firefox_out2.txt
	printf "Trial %d\n" $COUNTER

	sleep 1
	pkill -9 firefox
	for j in `seq 0 0`; do
		#( timeout -k 60 60 taskset -c $i ../../firefox-106.0.1/objdir/dist/firefox/firefox kaizen.html --no-remote -P profile$i $* &>> firefox_out.txt ) &
		( timeout -k 18 18  taskset -c 0,1,2,3,4,5,6,7 /usr/lib64/firefox/firefox warpattack1a.html  --no-remote -P al$i $* &>> firefox_out2.txt ) &
	done
	wait

	cat firefox_out2.txt >> out1126.txt

	COUNTER=$(( COUNTER + 1 ))
	grep "stack smashing" firefox_out2.txt >> success.out
	if (( i % 10 == 0 )); then
		rm -rf /home/linglong/Documents/profiles/*
		sleep 1
	fi
done;

